{% extends 'base.html' %}

{% block title %}Цели накопления - MoneyMind{% endblock %}

{% block content %}
<div class="mb-3">
    <a href="{% url 'budget:transaction_list' %}" class="btn btn-outline-secondary btn-sm">
        <i class="bi bi-arrow-left me-1"></i>Назад к дашборду
    </a>
</div>
    <div class="dashboard-theme">
        <div class="container-fluid py-4">
            <!-- Заголовок и кнопка -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="h2 fw-bold text-dark mb-1">Цели накопления</h1>
                    <p class="text-muted">Управление вашими финансовыми целями</p>
                </div>
                <a href="{% url 'budget:add_savings_goal' %}" class="btn btn-primary">
                    <i class="bi bi-plus-circle me-2"></i>Новая цель
                </a>
            </div>

            <!-- Общая статистика целей -->
            <div class="row mb-4">
                <div class="col-md-3 mb-3">
                    <div class="card stat-card stat-income">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="flex-grow-1">
                                    <h6 class="card-title text-muted mb-1">Всего целей</h6>
                                    <h4 class="fw-bold text-primary">{{ goals|length }}</h4>
                                </div>
                                <div class="flex-shrink-0">
                                    <i class="bi bi-bullseye display-6 text-primary opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stat-card stat-expense">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="flex-grow-1">
                                    <h6 class="card-title text-muted mb-1">Накоплено</h6>
                                    <h4 class="fw-bold text-success">{{ total_current_savings }} ₽</h4>
                                </div>
                                <div class="flex-shrink-0">
                                    <i class="bi bi-piggy-bank display-6 text-success opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stat-card stat-balance">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="flex-grow-1">
                                    <h6 class="card-title text-muted mb-1">Целевая сумма</h6>
                                    <h4 class="fw-bold text-info">{{ total_savings_goal }} ₽</h4>
                                </div>
                                <div class="flex-shrink-0">
                                    <i class="bi bi-flag display-6 text-info opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stat-card stat-free">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="flex-grow-1">
                                    <h6 class="card-title text-muted mb-1">Осталось</h6>
                                    <h4 class="fw-bold text-warning">{{ remaining_amount }} ₽</h4>
                                </div>
                                <div class="flex-shrink-0">
                                    <i class="bi bi-clock display-6 text-warning opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Список целей -->
            {% if goals %}
            <div class="row">
                {% for goal in goals %}
                <div class="col-xl-4 col-lg-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0 text-white">{{ goal.name }}</h5>
                            <div class="btn-group">
                                <a href="{% url 'budget:edit_savings_goal' goal.id %}" class="btn btn-sm btn-light" title="Редактировать">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a href="{% url 'budget:delete_savings_goal' goal.id %}" class="btn btn-sm btn-light" title="Удалить">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Прогресс бар -->
                            <div class="mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="text-muted small">Прогресс</span>
                                    <span class="fw-bold {% if goal.progress_percentage >= 100 %}text-success{% else %}text-primary{% endif %}">
                                        {{ goal.progress_percentage|floatformat:0 }}%
                                    </span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar {% if goal.progress_percentage >= 100 %}bg-success{% else %}bg-primary{% endif %}" 
                                        style="width: {{ goal.progress_percentage }}%">
                                    </div>
                                </div>
                            </div>

                            <!-- Суммы -->
                            <div class="row text-center mb-3">
                                <div class="col-6">
                                    <small class="text-muted">Накоплено</small>
                                    <div class="fw-bold text-success">{{ goal.current_amount }} ₽</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Цель</small>
                                    <div class="fw-bold text-primary">{{ goal.target_amount }} ₽</div>
                                </div>
                            </div>

                            <!-- Детали -->
                            <div class="goal-details">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <small class="text-muted">
                                        <i class="bi bi-flag me-1"></i>Приоритет
                                    </small>
                                    <span class="badge bg-primary">{{ goal.priority }}/10</span>
                                </div>
                                
                                {% if goal.deadline %}
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        <i class="bi bi-calendar me-1"></i>Срок
                                    </small>
                                    <small class="fw-bold">{{ goal.deadline|date:"d.m.Y" }}</small>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="card">
                <div class="card-body text-center py-5">
                    <i class="bi bi-bullseye display-1 text-muted opacity-50"></i>
                    <h5 class="mt-3 text-muted">У вас пока нет целей накопления</h5>
                    <p class="text-muted">Создайте первую цель для отслеживания прогресса</p>
                    <a href="{% url 'budget:add_savings_goal' %}" class="btn btn-primary mt-2">
                        <i class="bi bi-plus-circle me-2"></i>Создать цель
                    </a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

<style>
.goal-details small {
    font-size: 0.85rem;
}

.progress {
    border-radius: 4px;
}

.card.h-100 {
    transition: transform 0.2s ease;
}

.card.h-100:hover {
    transform: translateY(-2px);
}
</style>
{% endblock %}